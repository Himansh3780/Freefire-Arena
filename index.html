<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>FireTourney | Pro League</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { heading: ['Rajdhani', 'sans-serif'], body: ['Inter', 'sans-serif'] },
                    colors: {
                        'app-bg': '#000000',
                        'app-card': '#0a0a0a',
                        'brand-blue': '#2563eb',
                        'brand-gold': '#fbbf24',
                        'brand-red': '#ef4444',
                        'brand-wa': '#25D366'
                    },
                    boxShadow: {
                        'glow-blue': '0 0 15px rgba(37, 99, 235, 0.3)',
                        'glow-gold': '0 0 15px rgba(251, 191, 36, 0.3)'
                    }
                }
            }
        }
    </script>

    <style>
        /* APP FEEL */
        body { 
            background-color: #000; 
            color: #fff; 
            -webkit-tap-highlight-color: transparent; 
            padding-bottom: 90px; 
        }

        /* GLASS HEADER */
        .glass-header {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* CARD DESIGN */
        .match-card {
            background: #0a0a0a;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .match-card:active { transform: scale(0.98); } 

        /* BADGES & ANIMATIONS */
        .badge-live { background: #ef4444; animation: pulse 1.5s infinite; }
        
        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 50;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            color: #6b7280;
            transition: color 0.3s;
        }
        .nav-item.active { color: #3b82f6; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }

        /* MODAL POPUPS */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 60; backdrop-filter: blur(5px); justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: #111; border: 1px solid #333; width: 100%; max-width: 350px; border-radius: 20px; padding: 24px; animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        /* FOOTER STYLES */
        .site-footer { background-color: #050505; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #94a3b8; padding: 40px 20px; font-size: 14px; margin-top: 40px; }
        .footer-heading { color: #3b82f6; font-family: 'Rajdhani', sans-serif; font-weight: 700; text-transform: uppercase; margin-bottom: 15px; font-size: 18px; letter-spacing: 1px; }
        .footer-links a { color: #cbd5e1; text-decoration: none; display: block; margin-bottom: 8px; cursor: pointer; }
        .footer-links a:hover { color: #3b82f6; }
    </style>
</head>
<body class="font-body">

    <div id="maintenance-screen" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-6 text-center" style="display: none;">
        <div class="w-24 h-24 rounded-full bg-white/5 border border-white/10 flex items-center justify-center mb-6 animate-pulse">
            <i class="fa-solid fa-screwdriver-wrench text-4xl text-brand-gold"></i>
        </div>
        <h1 class="text-3xl font-heading font-bold text-white mb-2 uppercase tracking-wide">Under Maintenance</h1>
        <p id="maintenance-msg" class="text-gray-400 text-sm max-w-xs leading-relaxed mb-8">
            We are currently updating our servers to provide you with a better gaming experience.
        </p>
        <button onclick="window.location.reload()" class="bg-blue-600 px-6 py-3 rounded-xl font-bold text-sm uppercase shadow-glow-blue hover:bg-blue-700 transition-all">
            Check Again
        </button>
        <a href="https://wa.me/919294931405" target="_blank" class="mt-6 text-xs text-green-500 font-bold uppercase tracking-widest hover:text-green-400">
            Contact Support
        </a>
    </div>

    <nav class="glass-header sticky top-0 z-40 px-4 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center text-white font-bold text-sm shadow-glow-blue">FT</div>
            <span class="font-heading font-bold text-lg tracking-wide">FIRE<span class="text-blue-500">TOURNEY</span></span>
        </div>
        
        <div id="loginBtn" onclick="openAuthModal()" class="bg-blue-600/10 border border-blue-500/30 text-blue-400 px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-2 cursor-pointer">
            <i class="fa-solid fa-user"></i> LOGIN
        </div>
        <div id="userProfile" class="hidden items-center gap-2 bg-white/5 pr-3 py-1 pl-1 rounded-full border border-white/10 cursor-pointer" onclick="logoutUser()">
            <div class="w-7 h-7 rounded-full bg-green-500 flex items-center justify-center text-[10px] font-bold text-black">ID</div>
            <span class="text-[10px] font-bold text-gray-300">LOGOUT</span>
        </div>
    </nav>

    <div class="px-4 mt-6 mb-4 text-center">
        <h1 class="text-4xl font-heading font-bold uppercase leading-none mb-2">
            Play <span class="text-blue-500">Smart.</span><br>Win <span class="text-brand-gold">Cash.</span>
        </h1>
        
        <div class="inline-flex items-center gap-2 bg-white/5 border border-white/10 rounded-full px-4 py-1.5 mt-2">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
            </span>
            <span class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">NEXT MATCH: <span id="countdown" class="text-white">00:00:00</span></span>
        </div>
    </div>

    <div id="msg-box-container" class="px-4 mb-6"></div>

    <div class="px-4 mb-8">
        <div class="grid grid-cols-3 gap-2">
            <div class="bg-white/5 rounded-xl p-3 text-center border border-white/5">
                <i class="fa-solid fa-gamepad text-blue-500 mb-1 text-lg"></i>
                <div class="text-[10px] font-bold text-gray-300">1. Join</div>
            </div>
            <div class="bg-white/5 rounded-xl p-3 text-center border border-white/5">
                <i class="fa-brands fa-whatsapp text-green-500 mb-1 text-lg"></i>
                <div class="text-[10px] font-bold text-gray-300">2. Get ID</div>
            </div>
            <div class="bg-white/5 rounded-xl p-3 text-center border border-white/5">
                <i class="fa-solid fa-trophy text-brand-gold mb-1 text-lg"></i>
                <div class="text-[10px] font-bold text-gray-300">3. Win</div>
            </div>
        </div>
    </div>

    <div id="match-container" class="px-4 space-y-5">
    </div>

    <footer class="site-footer w-full">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
            <div>
                <div class="footer-heading">FireTourney</div>
                <p>The #1 destination for competitive gaming. Join securely, play fairly, and win instantly.</p>
                <p class="text-red-500 font-bold text-xs mt-3">‚ö†Ô∏è 18+ Only | One User = One Account</p>
            </div>
            <div>
                <div class="footer-heading">Policies</div>
                <div class="footer-links">
                    <a onclick="openModal('terms')">Terms & Conditions</a>
                    <a onclick="openModal('refund')">Refund & Cancellation</a>
                    <a onclick="openModal('privacy')">Privacy Policy</a>
                    <a onclick="openModal('rules')">Fair Play Rules</a>
                </div>
            </div>
            <div>
                <div class="footer-heading">Support</div>
                <p class="mb-2">
                    <strong>WhatsApp:</strong> 
                    <a href="https://wa.me/919294931405" target="_blank" class="text-green-400 hover:text-green-300">Chat Now</a>
                </p>
                <p class="mb-2"><strong>Email:</strong> support@firetourney.in</p>
                <p><strong>Hours:</strong> 10:00 AM ‚Äì 10:00 PM</p>
            </div>
        </div>
        <div class="text-center pt-8 mt-8 border-t border-white/10 text-xs text-gray-600">
            <p>&copy; 2026 FireTourney.in. All Rights Reserved.</p>
        </div>
    </footer>

    <div class="bottom-nav">
        <div class="nav-item active">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" onclick="openModal('rules')">
            <i class="fa-solid fa-book"></i>
            <span>Rules</span>
        </div>
        <div class="nav-item" onclick="window.location.href='https://t.me/FreeFirearena0'">
            <i class="fa-brands fa-telegram"></i>
            <span>Telegram</span>
        </div>
        <div class="nav-item" onclick="handleAccountClick()">
            <i class="fa-solid fa-user"></i>
            <span>Account</span>
        </div>
    </div>

    <div id="complianceModal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="text-xl font-heading font-bold text-white mb-2">‚ö†Ô∏è CONFIRMATION</h3>
            <p class="text-xs text-gray-400 mb-4">To continue with payment, please confirm:</p>
            
            <label class="flex gap-3 items-start bg-white/5 p-3 rounded-lg border border-white/10 mb-4 cursor-pointer">
                <input type="checkbox" id="legalCheck" class="mt-1 w-4 h-4 rounded accent-blue-600">
                <span class="text-xs text-gray-300 leading-tight">
                    I am <b>18 years or older</b> and I am <b>NOT playing</b> from Telangana, Andhra Pradesh, Assam, Odisha, Sikkim, or Nagaland.
                </span>
            </label>

            <button id="confirmPayBtn" class="bg-blue-600 w-full py-3 rounded-xl font-bold text-sm uppercase opacity-50 cursor-not-allowed">Proceed to Pay</button>
            <button onclick="closeComplianceModal()" class="w-full mt-3 text-xs text-gray-500 font-bold uppercase">Cancel</button>
        </div>
    </div>

    <div id="payModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:100; justify-content:center; align-items:center; padding:20px;">
        <div style="background:#111; border:1px solid #333; width:100%; max-width:380px; border-radius:16px; padding:24px; position:relative;">
            
            <div onclick="closePayModal()" style="position:absolute; top:15px; right:15px; color:#666; font-size:20px; cursor:pointer;">
                <i class="fa-solid fa-xmark"></i>
            </div>
    
            <h3 class="text-xl font-heading font-bold text-white mb-1 uppercase text-center">Scan To Pay</h3>
            <p class="text-gray-500 text-[10px] text-center mb-4">Paytm / PhonePe / GPay</p>
            
            <div class="bg-white p-2 rounded-xl mx-auto mb-4 w-48 h-48">
                <img id="qrImage" src="" class="w-full h-full object-contain">
            </div>
            
            <div class="text-center mb-4">
                <span class="text-gray-400 text-xs">Paying:</span>
                <span class="text-2xl font-bold text-brand-gold ml-1">‚Çπ<span id="displayAmount">0</span></span>
            </div>
    
            <form id="payForm" class="space-y-3">
                <input type="text" id="uName" placeholder="Your Name" required class="w-full bg-[#222] border border-[#333] rounded-lg px-4 py-3 text-sm text-white focus:border-brand-blue outline-none">
                <input type="text" id="uGameId" placeholder="Free Fire ID" required class="w-full bg-[#222] border border-[#333] rounded-lg px-4 py-3 text-sm text-white focus:border-brand-blue outline-none">
                
                <input type="text" id="uUPI" placeholder="Your UPI ID (e.g. rohan@paytm)" required class="w-full bg-[#222] border border-[#333] rounded-lg px-4 py-3 text-sm text-white focus:border-brand-blue outline-none">
                
                <input type="number" id="uUTR" placeholder="Enter 12-Digit UTR Number" required class="w-full bg-[#222] border border-[#333] rounded-lg px-4 py-3 text-sm text-white focus:border-brand-blue outline-none">
                
                <button type="submit" id="payBtn" class="w-full bg-green-600 py-3.5 rounded-xl font-bold text-sm uppercase shadow-glow-blue mt-2">
                    Verify on WhatsApp <i class="fa-brands fa-whatsapp ml-1"></i>
                </button>
            </form>
        </div>
    </div>

    <div id="waModal" class="modal-overlay flex" style="display:none; opacity:0; transition:opacity 0.3s;">
        <div class="modal-box text-center border border-brand-wa" style="box-shadow: 0 0 30px rgba(37,211,102,0.15);">
            <div class="mx-auto w-14 h-14 bg-brand-wa rounded-full flex items-center justify-center mb-4 shadow-[0_0_15px_#25D366] animate-pulse">
                <i class="fa-brands fa-whatsapp text-white text-3xl transform translate-y-0.5"></i>
            </div>
            <h3 class="font-heading font-bold text-2xl text-white mb-1 uppercase">Help & Support</h3>
            <p class="text-xs text-green-500 font-bold mb-4 uppercase tracking-widest">Get Room ID & Help</p>
            
            <div class="bg-gray-900 border border-gray-700 rounded-lg p-3 mb-5 text-left flex gap-3">
                <div class="text-green-500 text-lg"><i class="fa-solid fa-comment-dots"></i></div>
                <div>
                    <p class="text-[11px] text-gray-300 leading-tight">
                        <b class="text-white">Need Room ID or Prizes?</b><br>
                        Click below to message us on WhatsApp. We reply instantly!
                    </p>
                </div>
            </div>

            <a href="https://wa.me/919294931405" target="_blank" onclick="markWaJoined()" class="block w-full bg-brand-wa text-black font-bold py-3.5 rounded-xl uppercase text-sm mb-3 shadow-lg">
                Chat on WhatsApp
            </a>
            <button onclick="closeWaModal()" class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">Close Popup</button>
        </div>
    </div>

    <a href="https://wa.me/919294931405" target="_blank" class="float-wa" style="position:fixed; bottom:100px; right:20px; background:#25D366; width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-center; z-index:90; box-shadow:0 5px 20px rgba(37,211,102,0.4);">
        <i class="fa-brands fa-whatsapp text-white text-3xl"></i>
    </a>

    <div id="authModal" class="modal-overlay">
        <div class="modal-box text-center">
            <h3 id="authTitle" class="text-2xl font-heading font-bold text-white mb-1">WELCOME</h3>
            <p class="text-xs text-gray-500 mb-6">Login to join matches</p>
            <form id="authForm" class="flex flex-col gap-4">
                <input type="email" id="authEmail" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white text-sm outline-none" placeholder="Email Address" required>
                <input type="password" id="authPass" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white text-sm outline-none" placeholder="Password" required>
                <button type="submit" class="bg-blue-600 w-full py-3.5 rounded-xl font-bold text-sm uppercase shadow-glow-blue">Login Now</button>
            </form>
            <p id="toggleAuthMode" class="text-xs text-gray-500 mt-4 cursor-pointer hover:text-white">No account? <span class="text-blue-400 font-bold">Register Now</span></p>
            <button onclick="closeAuthModal()" class="text-[10px] text-gray-600 mt-4 uppercase font-bold">Close</button>
        </div>
    </div>

    <div id="infoModal" class="modal-overlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-box">
            <div class="flex justify-between items-center mb-4 border-b border-white/10 pb-4">
                <h3 id="modalTitle" class="font-heading font-bold text-xl uppercase text-blue-500">Info</h3>
                <button onclick="closeModal()" class="text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div id="modalBody" class="text-sm text-gray-300 space-y-3 leading-relaxed"></div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // üõ†Ô∏è ADMIN: CONFIGURATION
        // ---------------------------------------------------------
        
        // 1. MAINTENANCE MODE
        const ADMIN_MAINTENANCE = {
            enabled: false, 
            message: "We are updating our servers. Please check back in 30 minutes!"
        };

        // 2. DAILY UPDATE BOX
        const ADMIN_UPDATE_BOX = {
            show: true, 
            title: "üì¢ DAILY UPDATES",
            text: "Welcome Fighters! Match 3 (Pro League) is starting at 9:00 PM. Join fast before spots fill up!",
            color: "yellow" 
        };

        // 3. PAYMENT SETTINGS - UPDATED LINK
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzIr0e8EcBRpuFYqHzXscY2Bj9g0zAUt48YAKjmGLNPKkbgICINJLVqJ_ahLY0ioAYE/exec";
        const ADMIN_NUMBER = "919294931405"; // Your WhatsApp
        const MY_UPI_ID = "9294931405@ybl"; // Your UPI

        const ADMIN_CONTROLS = [
            {
                id: 1,
                name: "Starter Match",
                timeDisplay: "04:00 PM",
                map: "Bermuda",
                status: "OPEN", 
                entryFee: 0,
                prizePool: 100, 
                winnerPrize: 70,
                mvpPrize: 30,
                isFree: true,
                spotsFilled: 12,
                telegramLink: "https://t.me/FreeFirearena0"
            },
            {
                id: 2,
                name: "Warrior Battle",
                timeDisplay: "07:00 PM",
                map: "Purgatory",
                status: "OPEN", 
                entryFee: 50, 
                prizePool: 1575,
                winnerPrize: 1000,
                secondPrize: 50,
                thirdPrize: 25, 
                mvpPrize: 500,
                spotsFilled: 32,
                isPopular: true
            },
            {
                id: 3,
                name: "Pro League",
                timeDisplay: "09:00 PM",
                map: "Bermuda",
                status: "OPEN",
                entryFee: 100,
                prizePool: 3150,
                winnerPrize: 2000,
                secondPrize: 100,
                thirdPrize: 50,   
                mvpPrize: 1000,
                spotsFilled: 4
            }
        ];

        // CHECK MAINTENANCE
        function checkMaintenance() {
            if (ADMIN_MAINTENANCE.enabled) {
                document.getElementById('maintenance-screen').style.display = 'flex';
                document.getElementById('maintenance-msg').innerText = ADMIN_MAINTENANCE.message;
                document.body.style.overflow = 'hidden'; 
            }
        }
        checkMaintenance();

        // RENDER MESSAGE BOX
        function renderMsgBox() {
            const box = document.getElementById('msg-box-container');
            if(!ADMIN_UPDATE_BOX.show) {
                box.style.display = 'none';
                return;
            }
            const colorMap = {
                yellow: { border: 'border-yellow-500/50', icon: 'text-yellow-500', title: 'text-yellow-500' },
                red:    { border: 'border-red-500/50',    icon: 'text-red-500',    title: 'text-red-500' },
                blue:   { border: 'border-blue-500/50',   icon: 'text-blue-500',   title: 'text-blue-500' },
                green:  { border: 'border-green-500/50',  icon: 'text-green-500',  title: 'text-green-500' }
            };
            const theme = colorMap[ADMIN_UPDATE_BOX.color] || colorMap.yellow;
            box.innerHTML = `
                <div class="bg-white/5 border ${theme.border} rounded-xl p-3 flex gap-3 items-start shadow-lg">
                    <div class="text-xl ${theme.icon} animate-pulse mt-0.5">
                        <i class="fa-solid fa-bullhorn"></i>
                    </div>
                    <div>
                        <h4 class="text-xs font-bold uppercase tracking-widest ${theme.title} mb-1">${ADMIN_UPDATE_BOX.title}</h4>
                        <p class="text-xs text-gray-300 leading-relaxed font-medium">${ADMIN_UPDATE_BOX.text}</p>
                    </div>
                </div>
            `;
        }
        renderMsgBox();

        const container = document.getElementById('match-container');
        
        // --- JOIN & PAYMENT FLOW VARIABLES ---
        let pendingMatchId = 0;
        let pendingMatchName = "";
        let pendingAmount = 0;

        // 1. CLICK JOIN -> OPEN CHECKBOX MODAL
        function initiateJoin(matchId, matchName, amount) {
            if (!localStorage.getItem('ft_user')) {
                openAuthModal();
                return;
            }
            // Check if already joined
            if(localStorage.getItem('joined_match_' + matchId)) {
                alert("You have already joined this match!");
                return;
            }

            // Save details
            pendingMatchId = matchId;
            pendingMatchName = matchName;
            pendingAmount = amount;

            // Reset and Show Compliance Modal
            document.getElementById('legalCheck').checked = false;
            document.getElementById('confirmPayBtn').classList.add('opacity-50', 'cursor-not-allowed');
            document.getElementById('confirmPayBtn').onclick = null; 
            
            document.getElementById('complianceModal').style.display = 'flex';
        }

        function closeComplianceModal() {
            document.getElementById('complianceModal').style.display = 'none';
        }

        // 2. CHECKBOX LOGIC
        document.getElementById('legalCheck').addEventListener('change', function() {
            const btn = document.getElementById('confirmPayBtn');
            if(this.checked) {
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                // CLICKING PROCEED NOW OPENS MANUAL PAY MODAL
                btn.onclick = () => {
                    closeComplianceModal();
                    openPayModal(pendingAmount, pendingMatchName);
                }; 
            } else {
                btn.classList.add('opacity-50', 'cursor-not-allowed');
                btn.onclick = null; 
            }
        });

        // 3. MANUAL PAY MODAL LOGIC
        window.openPayModal = (fee, matchName) => {
            document.getElementById('displayAmount').innerText = fee;
            document.getElementById('payBtn').innerText = "Verify on WhatsApp";
            document.getElementById('payBtn').disabled = false;
            
            // Generate QR Code with your UPI ID
            const upiLink = `upi://pay?pa=${MY_UPI_ID}&pn=FireTourney&am=${fee}&cu=INR`;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiLink)}`;
            document.getElementById('qrImage').src = qrUrl;
            
            document.getElementById('payModal').style.display = 'flex';
        };

        window.closePayModal = () => document.getElementById('payModal').style.display = 'none';

        // 4. HANDLE PAYMENT FORM SUBMIT (FIXED TO SEND JSON)
        document.getElementById('payForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('payBtn');
            btn.innerText = "Saving Details...";
            btn.disabled = true;

            const uName = document.getElementById('uName').value;
            const uGameId = document.getElementById('uGameId').value;
            const uUPI = document.getElementById('uUPI').value;
            const uUTR = document.getElementById('uUTR').value;

            // FIX: Create a clean JSON Object
            const dataObj = {
                name: uName,
                gameId: uGameId,
                upi: uUPI,
                utr: uUTR,
                amount: pendingAmount,
                match: pendingMatchName,
                date: new Date().toLocaleString()
            };

            // FIX: Send as JSON String to bypass CORS
            fetch(GOOGLE_SCRIPT_URL, { 
                method: "POST", 
                body: JSON.stringify(dataObj) 
            })
            .then(res => {
                // Redirect User to WhatsApp
                const msg = `*NEW PAYMENT*%0A------------------%0A*Match:* ${pendingMatchName}%0A*Amount:* ‚Çπ${pendingAmount}%0A*Name:* ${uName}%0A*ID:* ${uGameId}%0A*User UPI:* ${uUPI}%0A*UTR:* ${uUTR}%0A------------------%0A_Please verify my payment and send me the Group Link._`;
                
                window.location.href = `https://wa.me/${ADMIN_NUMBER}?text=${msg}`;
            })
            .catch(err => {
                // If fetch fails (network), still redirect as backup
                const msg = `*NEW PAYMENT*%0A------------------%0A*Match:* ${pendingMatchName}%0A*Amount:* ‚Çπ${pendingAmount}%0A*Name:* ${uName}%0A*ID:* ${uGameId}%0A*User UPI:* ${uUPI}%0A*UTR:* ${uUTR}%0A------------------%0A_Please verify my payment and send me the Group Link._`;
                window.location.href = `https://wa.me/${ADMIN_NUMBER}?text=${msg}`;
            });
        });

        function renderMatches() {
            container.innerHTML = "";
            ADMIN_CONTROLS.forEach(match => {
                let badgeClass = "", badgeText = "", btnClass = "", btnText = "";
                let buttonAction = "";

                const isJoined = localStorage.getItem('joined_match_' + match.id);

                if (isJoined) {
                    badgeClass = "bg-green-600 text-white";
                    badgeText = "JOINED";
                    btnClass = "bg-green-600 border border-green-500 text-white shadow-[0_0_15px_rgba(34,197,94,0.4)]";
                    btnText = "‚úÖ JOINED SUCCESSFULLY";
                    buttonAction = "showWaModal()"; 
                } else if(match.status === "OPEN") {
                    badgeClass = "bg-blue-600 text-white";
                    badgeText = "OPEN";
                    if (match.isFree) {
                        btnClass = "bg-green-600 active:bg-green-700 text-white shadow-[0_0_15px_rgba(34,197,94,0.4)]";
                        btnText = "JOIN FOR FREE";
                        buttonAction = `window.open('${match.telegramLink}', '_blank')`;
                    } else {
                        btnClass = "bg-blue-600 active:bg-blue-700 text-white shadow-glow-blue";
                        btnText = `Join for ‚Çπ${match.entryFee}`;
                        // CALLS INITIATE JOIN -> COMPLIANCE -> MANUAL PAY
                        buttonAction = `initiateJoin(${match.id}, '${match.name}', ${match.entryFee})`;
                    }
                } else if (match.status === "FULL") {
                    badgeClass = "bg-red-600 text-white";
                    badgeText = "FULL";
                    btnClass = "bg-gray-800 text-gray-500 cursor-not-allowed";
                    btnText = "SEATS FULL";
                    buttonAction = "return false;";
                } else {
                    badgeClass = "bg-gray-700 text-gray-400";
                    badgeText = "ENDED";
                    btnClass = "bg-gray-800 text-gray-500 cursor-not-allowed";
                    btnText = "CLOSED";
                    buttonAction = "return false;";
                }

                const widthPct = (match.spotsFilled / 48) * 100;
                let spotColor = "text-blue-400";
                if(match.spotsFilled > 40) spotColor = "text-red-500";

                let extraPrizesHtml = '';
                if (match.secondPrize > 0) {
                    extraPrizesHtml += `
                        <div class="bg-white/5 rounded-lg p-2 flex items-center gap-2 border border-white/5">
                            <i class="fa-solid fa-medal text-gray-300 ml-1"></i>
                            <div><div class="text-[9px] text-gray-400 uppercase">2nd Rank</div><div class="text-sm font-bold">‚Çπ${match.secondPrize}</div></div>
                        </div>`;
                }
                if (match.thirdPrize > 0) {
                    extraPrizesHtml += `
                        <div class="bg-white/5 rounded-lg p-2 flex items-center gap-2 border border-white/5">
                            <i class="fa-solid fa-medal text-orange-700 ml-1"></i>
                            <div><div class="text-[9px] text-gray-400 uppercase">3rd Rank</div><div class="text-sm font-bold">‚Çπ${match.thirdPrize}</div></div>
                        </div>`;
                }

                const html = `
                <div class="match-card ${match.isPopular ? 'border-brand-gold/30' : ''}">
                    ${match.isPopular ? '<div class="absolute top-0 left-0 bg-brand-gold text-black text-[9px] font-bold px-3 py-1 rounded-br-xl z-10">POPULAR</div>' : ''}
                    <div class="absolute top-0 right-0 z-10">
                        <span class="${badgeClass} text-[9px] font-bold px-3 py-1 rounded-bl-xl uppercase">${badgeText}</span>
                    </div>
                    <div class="p-4 pt-6">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="text-xl font-heading font-bold text-white ${match.isPopular ? 'text-shadow-gold' : ''}">${match.name}</h3>
                                <div class="text-[10px] font-bold ${match.isPopular ? 'text-yellow-500' : 'text-blue-400'} uppercase mt-0.5">
                                    <i class="fa-regular fa-clock mr-1"></i> ${match.timeDisplay} ‚Ä¢ ${match.map}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] text-gray-500 uppercase font-bold">Prize Pool</div>
                                <div class="text-xl font-heading font-bold text-brand-gold">${match.prizePool > 0 ? '‚Çπ'+match.prizePool : 'Free'}</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-4">
                            <div class="bg-white/5 rounded-lg p-2 flex items-center gap-2 border ${match.isPopular ? 'border-brand-gold/20' : 'border-white/5'}">
                                <i class="fa-solid fa-trophy text-yellow-500 ml-1"></i>
                                <div><div class="text-[9px] text-gray-400 uppercase">Booyah</div><div class="text-sm font-bold">‚Çπ${match.winnerPrize}</div></div>
                            </div>
                            <div class="bg-white/5 rounded-lg p-2 flex items-center gap-2 border border-white/5">
                                <i class="fa-solid fa-skull text-red-500 ml-1"></i>
                                <div><div class="text-[9px] text-gray-400 uppercase">MVP</div><div class="text-sm font-bold">‚Çπ${match.mvpPrize}</div></div>
                            </div>
                            ${extraPrizesHtml}
                        </div>
                        <div class="flex justify-between text-[10px] text-gray-400 mb-1 font-bold"><span>SPOTS</span><span class="${spotColor}">${48 - match.spotsFilled} Left</span></div>
                        <div class="h-1 bg-white/10 rounded-full mb-4 overflow-hidden"><div class="h-full ${match.isPopular ? 'bg-yellow-500' : 'bg-blue-600'}" style="width: ${widthPct}%"></div></div>
                        <button onclick="${buttonAction}" class="block w-full ${btnClass} text-center font-bold py-3 rounded-xl uppercase text-xs tracking-wider transition-all">
                            ${btnText}
                        </button>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }
        renderMatches();

        // COUNTDOWN
        function updateCountdown() {
            const now = new Date();
            const h = now.getHours();
            const targetHours = [16, 19, 21];
            let nextH = targetHours.find(t => t > h);
            const target = new Date();
            if(!nextH) { target.setDate(target.getDate() + 1); target.setHours(16, 0, 0, 0); } 
            else { target.setHours(nextH, 0, 0, 0); }
            const diff = target - now;
            const hh = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const mm = Math.floor((diff / (1000 * 60)) % 60);
            const ss = Math.floor((diff / 1000) % 60);
            document.getElementById('countdown').innerText = `${hh.toString().padStart(2,'0')}:${mm.toString().padStart(2,'0')}:${ss.toString().padStart(2,'0')}`;
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // AUTH & POPUP LOGIC
        function checkLoginState() {
            const user = localStorage.getItem('ft_user');
            if(user) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('userProfile').classList.remove('hidden');
                document.getElementById('userProfile').classList.add('flex');
            } else {
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('userProfile').classList.add('hidden');
                document.getElementById('userProfile').classList.remove('flex');
            }
        }
        checkLoginState();

        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            if(email.length > 5) {
                localStorage.setItem('ft_user', email);
                closeAuthModal();
                checkLoginState();
            }
        });

        document.getElementById('toggleAuthMode').addEventListener('click', () => {
            const title = document.getElementById('authTitle');
            title.innerText = title.innerText === "WELCOME" ? "REGISTER" : "WELCOME";
        });

        window.openAuthModal = () => document.getElementById('authModal').style.display = 'flex';
        window.closeAuthModal = () => document.getElementById('authModal').style.display = 'none';
        window.logoutUser = () => { localStorage.removeItem('ft_user'); checkLoginState(); }
        window.handleAccountClick = () => { if(localStorage.getItem('ft_user')) logoutUser(); else openAuthModal(); }

        const waModal = document.getElementById('waModal');
        window.showWaModal = () => {
            waModal.style.display = 'flex';
            setTimeout(() => waModal.style.opacity = '1', 100);
        }
        window.markWaJoined = () => {
            localStorage.setItem('wa_joined', 'true');
            setTimeout(window.closeWaModal, 1000);
        }
        window.closeWaModal = () => {
            waModal.style.opacity = '0';
            setTimeout(() => waModal.style.display = 'none', 300);
        }
        // Auto show WhatsApp modal on first load after 2.5s if not joined
        if(!localStorage.getItem('wa_joined')) {
            window.addEventListener('load', () => setTimeout(showWaModal, 2500));
        }

        // RULES & MODALS (STATE BAN POLICY INCLUDED)
        const policies = {
            terms: "<h3>Terms & Conditions</h3><p>Participation restricted to users 18+. One account per user. We reserve the right to ban cheaters.</p>",
            refund: "<h3>Refund Policy</h3><p>Refunds are only issued if a match is cancelled by the admin. No refunds for player disconnection.</p>",
            privacy: "<h3>Privacy Policy</h3><p>We do not share your data. Phone numbers are used for Room ID distribution only via WhatsApp.</p>",
            rules: `
                <h3 class='text-blue-500 font-bold text-lg mb-2'>‚ö†Ô∏è Tournament Rules</h3>
                <ul class='list-disc pl-5 space-y-2 text-gray-300'>
                    <li><b>Zero Tolerance:</b> No Teaming, No Hacking, No Scripts. Result = Instant Ban.</li>
                    <li><b>Device:</b> Mobile Only. Emulators are strictly prohibited.</li>
                    <li><b>Proof:</b> Winners must send a screenshot of the results to the Telegram Admin to claim prizes.</li>
                    
                    <li class='text-red-400 font-bold'>
                        üö´ RESTRICTED STATES:
                        Users from Telangana, Andhra Pradesh, Assam, Odisha, Sikkim, and Nagaland are NOT allowed to play for money due to state laws.
                    </li>

                    <li class='text-yellow-500 font-bold border border-yellow-500/30 p-2 rounded bg-yellow-500/10'>
                        üí∞ Prize Pool Clause: The announced Prize Pool is based on a full lobby (48 players). If participation is low (less than 40 players), the Prize Pool will be adjusted/reduced accordingly.
                    </li>
                </ul>
            `
        };
        window.openModal = (type) => {
            const titleMap = { terms: "Terms", refund: "Refunds", privacy: "Privacy", rules: "Rules" };
            document.getElementById('modalTitle').innerText = titleMap[type] || "Info";
            document.getElementById('modalBody').innerHTML = policies[type];
            document.getElementById('infoModal').style.display = 'flex';
        }
        window.closeModal = () => document.getElementById('infoModal').style.display = 'none';
    </script>
</body>
</html>
